<div class="sensors">
  <div class="title">
    <h3>Sensors</h3>
    <h4 (click)="toggleForm()">Add Sensor</h4>
  </div>

  <div class="sensor-form" *ngIf="formON">
    <form
      class="sensors-form"
      #deviceForm="ngForm"
      (ngSubmit)="onSubmit(deviceForm)"
      *ngIf="formON"
    >
      <div class="form-control">
        <label for="device_id">ID</label>
        <input
          class="form-input"
          id="device_id"
          type="text"
          placeholder="Device ID"
          ngModel
          name="device_id"
        />
      </div>
      <div class="form-control">
        <label for="device_name">Name</label>
        <input
          class="form-input"
          id="device_name"
          type="text"
          placeholder="Device name"
          ngModel
          name="device_name"
        />
      </div>
      <div class="form-control">
        <label for="dev_eui">Dev eui</label>
        <input
          class="form-input"
          id="dev_eui"
          type="text"
          placeholder="Dev EUI"
          ngModel
          name="dev_eui"
        />
      </div>
      <div class="form-control">
        <label for="join_eui">Join eui</label>
        <input
          class="form-input"
          id="join_eui"
          type="text"
          placeholder="Join EUI"
          ngModel
          name="join_eui"
        />
      </div>
      <div class="form-control">
        <label for="image_path">Image Path</label>
        <input
          class="form-input"
          ngModel
          name="image_path"
          type="file"
          (change)="onFileChange($event)"
        />
      </div>
      <div class="form-control">
        <label for="device_status">Device Status</label>
        <div class="form-toggle">
          <input
            type="checkbox"
            [(ngModel)]="isOn"
            name="toggleSwitch"
            class="toggle"
          />
          <span>{{ isOn ? "ON" : "OFF" }}</span>
        </div>
      </div>
      <div class="form-control">
        <span></span>
        <input class="btn" type="submit" value="Submit" />
      </div>
    </form>

    <div class="ship-container" *ngIf="imagePreview">
      <img
        src="{{ imagePreview }}"
        class="ship-image"
      />
      <div class="grid-overlay"></div>
    </div>
  </div>

  <div class="sensor-grid">
    <div class="sensor-card" *ngFor="let sensor of allSensors">
      <div class="sensor-content">
        <img
          [src]="getImageUrl(sensor.image_path)"
          alt="{{ sensor.device_name }}"
          class="sensor_img"
        />
      </div>

      <div class="sensor-footer">
        <div class="sensor-meta">
          <h3>
            <a
              class="device_id"
              [routerLink]="['/device',sensor.device_id]"
              >{{ sensor.device_name }}</a
            >
          </h3>
          <p>{{ sensor.device_id }}</p>
        </div>

        <div
          class="sensor-status"
          [ngClass]="getStatusClass(sensor.device_status)"
        >
          {{ sensor.device_status }}
        </div>

        <div class="sensor-actions" *ngIf="isAuthenticated">
          <button class="edit" (click)="editSensor(sensor.id)">Edit</button>
          <button class="delete" (click)="showDeleteModal(sensor.id)">
            Delete
          </button>
        </div>
      </div>
    </div>
  </div>
</div>

<app-delete-data-modal
  [visible]="modalDeleteON"
  [title]="'Delete Sensor'"
  [message]="'Are you sure you want to delete this item?'"
  (cancel)="closeDeleteModal()"
  (confirm)="deleteSensor()"
/>

<app-login-modal
  [visible]="loginModalON"
  (cancel)="closeLoginModal()"
  (login)="handleLogin($event)"
></app-login-modal>
