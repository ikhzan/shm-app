<div class="brokers">
  <div class="title">
    <h3>Brokers</h3>
    <h4 (click)="toggleForm()">Add Broker</h4>
  </div>

  <form
    class="brokers-form"
    #brokerForm="ngForm"
    (ngSubmit)="onSubmit(brokerForm)"
    *ngIf="formON"
  >
    <div class="form-control">
      <label for="device_name">Name</label>
      <input
        class="form-input"
        id="device_name"
        type="text"
        placeholder="broker name"
        ngModel
        name="device_name"
      />
    </div>
    <div class="form-control">
      <label for="url_path">URL</label>
      <input
        class="form-input"
        id="url_path"
        type="text"
        placeholder="broker url"
        ngModel
        name="url_path"
      />
    </div>
    <div class="form-control">
      <label for="status">Status</label>
      <div class="form-toggle">
        <input
          type="checkbox"
          [(ngModel)]="isOn"
          name="toggleSwitch"
          class="toggle"
        />
        <span>{{ isOn ? "ON" : "OFF" }}</span>
      </div>
    </div>
    <div class="form-control">
      <span></span>
      <input class="btn" type="submit" value="Submit" />
    </div>
  </form>

  <div class="top-table">
    <div class="show-limit flex items-center gap-2">
      <label for="show">Show:</label>
      <select (change)="onPageSizeChange($event)">
        <option *ngFor="let size of [5, 10, 20, 50]" [value]="size">
          {{ size }}
        </option>
      </select>
      <label>Entries</label>
    </div>

    <div class="search flex items-center gap-2">
      <input
        type="text"
        placeholder="Search"
        [(ngModel)]="searchTerm"
        (input)="onSearch(searchTerm)"
        class="border px-2 py-1 rounded"
      />
      <fa-icon [icon]="faSearch"></fa-icon>
    </div>
  </div>

  <table class="table">
    <thead>
      <tr>
        <th class="check"></th>
        <th>Name</th>
        <th>Status</th>
        <th>URL</th>
        <th>Action</th>
      </tr>
    </thead>
    <tbody>
      <tr *ngIf="isLoading">
        <td colspan="5" class="loading">Loading broker data...</td>
      </tr>
      <tr *ngFor="let broker of dataBroker">
        <td><input type="checkbox" name="" id="{{ broker.id }}" /></td>
        <td>{{ broker.device_name }}</td>
        <td>{{ broker.status }}</td>
        <td>{{ broker.url_path }}</td>
        <td>
          <fa-icon
            [icon]="faTrash"
            class="delete-icon"
            (click)="showDeleteModal(broker.id)"
          ></fa-icon>
        </td>
      </tr>
      <tr *ngIf="!isLoading && dataBroker.length === 0">
        <td colspan="5" class="no-data">No broker data available.</td>
      </tr>
    </tbody>
  </table>

  <div class="bottom-table flex justify-between items-center mt-4">
    <div class="page-no">
      <p>
        Showing {{ (currentPage - 1) * pageSize + 1 }} to
        {{ Math.min(currentPage * pageSize, allBrokers.length) }} of
        {{ allBrokers.length }} entries
      </p>
    </div>

    <div class="page-buttons flex gap-2">
      <button class="prev-button px-3 py-1 border rounded" (click)="prevPage()">
        Prev
      </button>
      <button class="next-button px-3 py-1 border rounded" (click)="nextPage()">
        Next
      </button>
    </div>
  </div>
</div>

<div class="modal" [hidden]="modalDeleteON">
  <div class="modal-content">
    <div class="modal-header">
      <h2>Delete Broker Connection</h2>
      <fa-icon [icon]="faClose" (click)="closeDeleteModal()"></fa-icon>
    </div>
    <div class="modal-body">
      <p>are you sure delete this item?</p>
    </div>
    <div class="modal-btns">
      <button (click)="closeDeleteModal()">Cancel</button>
      <button class="delete-btn" (click)="deleteFile()">Delete</button>
    </div>
  </div>
</div>
