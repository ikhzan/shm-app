<div class="vehicles">
  <div class="title">
    <h3>Vehicles</h3>
    <h4 (click)="toggleForm()">Add Vehicle</h4>
  </div>

  <div class="vehicle-form" *ngIf="formON">
    <form
      class="form-group"
      enctype="multipart/form-data"
      [formGroup]="vehicleForm"
      (ngSubmit)="onSubmit()"
    >
      <div class="form-control">
        <label for="name">Vehicle Name</label>
        <input
          class="form-input"
          id="name"
          type="text"
          placeholder="Device name"
          formControlName="name"
          name="name"
        />
      </div>
      <div class="form-control">
        <label for="image_path">Image Path</label>
        <input
          class="form-input"
          formControlName="image_path"
          name="image_path"
          type="file"
          (change)="onFileChange($event)"
        />
      </div>
      <div class="button-group">
        <div class="message"></div>
        <div class="btns">
          <input class="btn-cancel" type="button" value="Cancel" (click)="cancelAction()" />
          <input class="btn-submit" type="submit" value="{{ isEditMode ? 'Update' : 'Create' }}" />
        </div>
      </div>
    </form>

    <div class="shops">
      <div class="unliked-sensors">
        <h2>Unlinked Sensors</h2>
        <div class="sensor-info">
          <div class="description">
            <p>
              These sensors are avaible but not attached yet, so we can see it
              here
            </p>
          </div>
          <ol>
            <li *ngFor="let sensor of unlinkedSensors">
              {{ sensor.device_name }} with ID: {{ sensor.id }}
            </li>
          </ol>
        </div>
      </div>

      <div class="ship-container" *ngIf="imagePreview">
        <img
          [src]="imagePreview"
          class="ship-image"
          (click)="placeHolder($event)"
        />

        <div class="grid-overlay"></div>

        <div
          *ngFor="let sensor of placedSensors"
          class="sensor-lamp"
          [style.left.%]="sensor.position_x"
          [style.top.%]="sensor.position_y"
          [ngClass]="getLampClass(sensor.value)"
        >
          <div class="tooltip">
            {{ sensor.device_name }}<br />
            x: {{ sensor.position_x }}%, y: {{ sensor.position_y }}%
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="sensor-grid">
    <div class="sensor-card" *ngFor="let vehicle of vehicles">
      <div class="sensor-content">
        <img
          [src]="getImage(vehicle.image_path)"
          alt="{{ vehicle.name }}"
          class="sensor_img"
        />
      </div>

      <div class="sensor-footer">
        <div class="sensor-meta">
          <h3>
            <a class="sensor_id" [routerLink]="['/vehicles', vehicle.id]">
              {{ vehicle.name }}</a
            >
          </h3>
          <p>
            Sensors: ({{
              vehicle.end_devices?.length > 0 ? vehicle.end_devices.length : 0
            }})
          </p>
        </div>

        <div class="sensor-actions" *ngIf="isAuthenticated">
          <button class="edit" (click)="editVehicle(vehicle.id)">Edit</button>
          <button class="delete" (click)="showDeleteModal(vehicle.id)">
            Delete
          </button>
        </div>
      </div>
    </div>
  </div>
</div>

<app-delete-data-modal
  [visible]="modalDeleteON"
  [title]="'Delete Vehicle'"
  [message]="'Are you sure you want to delete this item?'"
  (cancel)="closeDeleteModal()"
  (confirm)="deleteVehicle()"
/>

<app-login-modal
  [visible]="loginModalON"
  (cancel)="closeLoginModal()"
  (login)="handleLogin($event)"
></app-login-modal>
